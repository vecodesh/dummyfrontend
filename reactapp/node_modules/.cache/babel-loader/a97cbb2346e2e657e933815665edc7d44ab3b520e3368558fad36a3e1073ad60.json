{"ast":null,"code":"module.exports = /******/function () {\n  // webpackBootstrap\n  /******/\n  \"use strict\";\n\n  /******/\n  var __webpack_modules__ = {\n    /***/\"./src/index.ts\": (/***/function (__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n      // ESM COMPAT FLAG\n      __webpack_require__.r(__webpack_exports__);\n\n      // EXPORTS\n      __webpack_require__.d(__webpack_exports__, {\n        \"Upload\": function () {\n          return /* reexport */Upload;\n        },\n        \"UploadApiError\": function () {\n          return /* reexport */UploadApiError;\n        }\n      });\n      ; // CONCATENATED MODULE: external \"@upload-io/upload-api-client-upload-js\"\n      var upload_api_client_upload_js_namespaceObject = require(\"@upload-io/upload-api-client-upload-js\");\n      ;\n      ; // CONCATENATED MODULE: ./src/Mutex.ts\n      /**\n       * A lightweight mutex. (Other libraries contain too many features and we want to keep the size upload-js down).\n       *\n       * Characteristics:\n       * - Non-reentrant.\n       * - Unfair. (Multiple callers awaiting 'acquire' will be granted the mutex in no order.)\n       *   - When calling `safe` consecutively with no 'awaits' in-between, the current context will synchronously acquire\n       *     the mutex every time.\n       */\n      function _call(body, then, direct) {\n        if (direct) {\n          return then ? then(body()) : body();\n        }\n        try {\n          var result = Promise.resolve(body());\n          return then ? result.then(then) : result;\n        } catch (e) {\n          return Promise.reject(e);\n        }\n      }\n      function _rethrow(thrown, value) {\n        if (thrown) throw value;\n        return value;\n      }\n      function _finallyRethrows(body, finalizer) {\n        try {\n          var result = body();\n        } catch (e) {\n          return finalizer(true, e);\n        }\n        if (result && result.then) {\n          return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n        }\n        return finalizer(false, result);\n      }\n      function _empty() {}\n      function _awaitIgnored(value, direct) {\n        if (!direct) {\n          return value && value.then ? value.then(_empty) : Promise.resolve();\n        }\n      }\n      function _settle(pact, state, value) {\n        if (!pact.s) {\n          if (value instanceof _Pact) {\n            if (value.s) {\n              if (state & 1) {\n                state = value.s;\n              }\n              value = value.v;\n            } else {\n              value.o = _settle.bind(null, pact, state);\n              return;\n            }\n          }\n          if (value && value.then) {\n            value.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n            return;\n          }\n          pact.s = state;\n          pact.v = value;\n          var observer = pact.o;\n          if (observer) {\n            observer(pact);\n          }\n        }\n      }\n      var _Pact = /*#__PURE__*/function () {\n        function _Pact() {}\n        _Pact.prototype.then = function (onFulfilled, onRejected) {\n          var result = new _Pact();\n          var state = this.s;\n          if (state) {\n            var callback = state & 1 ? onFulfilled : onRejected;\n            if (callback) {\n              try {\n                _settle(result, 1, callback(this.v));\n              } catch (e) {\n                _settle(result, 2, e);\n              }\n              return result;\n            } else {\n              return this;\n            }\n          }\n          this.o = function (_this) {\n            try {\n              var value = _this.v;\n              if (_this.s & 1) {\n                _settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n              } else if (onRejected) {\n                _settle(result, 1, onRejected(value));\n              } else {\n                _settle(result, 2, value);\n              }\n            } catch (e) {\n              _settle(result, 2, e);\n            }\n          };\n          return result;\n        };\n        return _Pact;\n      }();\n      function _isSettledPact(thenable) {\n        return thenable instanceof _Pact && thenable.s & 1;\n      }\n      function _for(test, update, body) {\n        var stage;\n        for (;;) {\n          var shouldContinue = test();\n          if (_isSettledPact(shouldContinue)) {\n            shouldContinue = shouldContinue.v;\n          }\n          if (!shouldContinue) {\n            return result;\n          }\n          if (shouldContinue.then) {\n            stage = 0;\n            break;\n          }\n          var result = body();\n          if (result && result.then) {\n            if (_isSettledPact(result)) {\n              result = result.s;\n            } else {\n              stage = 1;\n              break;\n            }\n          }\n          if (update) {\n            var updateValue = update();\n            if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n              stage = 2;\n              break;\n            }\n          }\n        }\n        var pact = new _Pact();\n        var reject = _settle.bind(null, pact, 2);\n        (stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n        return pact;\n        function _resumeAfterBody(value) {\n          result = value;\n          do {\n            if (update) {\n              updateValue = update();\n              if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n                updateValue.then(_resumeAfterUpdate).then(void 0, reject);\n                return;\n              }\n            }\n            shouldContinue = test();\n            if (!shouldContinue || _isSettledPact(shouldContinue) && !shouldContinue.v) {\n              _settle(pact, 1, result);\n              return;\n            }\n            if (shouldContinue.then) {\n              shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n              return;\n            }\n            result = body();\n            if (_isSettledPact(result)) {\n              result = result.v;\n            }\n          } while (!result || !result.then);\n          result.then(_resumeAfterBody).then(void 0, reject);\n        }\n        function _resumeAfterTest(shouldContinue) {\n          if (shouldContinue) {\n            result = body();\n            if (result && result.then) {\n              result.then(_resumeAfterBody).then(void 0, reject);\n            } else {\n              _resumeAfterBody(result);\n            }\n          } else {\n            _settle(pact, 1, result);\n          }\n        }\n        function _resumeAfterUpdate() {\n          if (shouldContinue = test()) {\n            if (shouldContinue.then) {\n              shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n            } else {\n              _resumeAfterTest(shouldContinue);\n            }\n          } else {\n            _settle(pact, 1, result);\n          }\n        }\n      }\n      function _continue(value, then) {\n        return value && value.then ? value.then(then) : then(value);\n      }\n      function _async(f) {\n        return function () {\n          for (var args = [], i = 0; i < arguments.length; i++) {\n            args[i] = arguments[i];\n          }\n          try {\n            return Promise.resolve(f.apply(this, args));\n          } catch (e) {\n            return Promise.reject(e);\n          }\n        };\n      }\n      function Mutex() {\n        var mutex;\n        var resolver;\n        var safe = function safe(callback) {\n          return _call(acquire, function () {\n            return _finallyRethrows(callback, function (_wasThrown, _result) {\n              release();\n              return _rethrow(_wasThrown, _result);\n            });\n          });\n        };\n        var acquire = _async(function () {\n          // Loop necessary for when multiple calls are made to 'acquire' before a 'release' is called, else the call to\n          // 'release' will resume every caller currently waiting on 'acquire'.\n          // eslint-disable-next-line no-unmodified-loop-condition\n          return _continue(_for(function () {\n            return mutex !== undefined;\n          }, void 0, function () {\n            return _awaitIgnored(mutex);\n          }), function () {\n            mutex = new Promise(function (resolve) {\n              resolver = resolve;\n            });\n          });\n        });\n        var release = function release() {\n          if (resolver === undefined) {\n            throw new Error(\"Unable to release mutex: already released.\");\n          }\n          resolver();\n          resolver = undefined;\n          mutex = undefined;\n        };\n        return {\n          safe: safe\n        };\n      }\n      ; // CONCATENATED MODULE: external \"progress-smoother\"\n      var external_progress_smoother_namespaceObject = require(\"progress-smoother\");\n      ;\n      ; // CONCATENATED MODULE: ./src/UploadApiError.ts\n      function _typeof(obj) {\n        \"@babel/helpers - typeof\";\n\n        return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n          return typeof obj;\n        } : function (obj) {\n          return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n        }, _typeof(obj);\n      }\n      function _defineProperties(target, props) {\n        for (var i = 0; i < props.length; i++) {\n          var descriptor = props[i];\n          descriptor.enumerable = descriptor.enumerable || false;\n          descriptor.configurable = true;\n          if (\"value\" in descriptor) descriptor.writable = true;\n          Object.defineProperty(target, descriptor.key, descriptor);\n        }\n      }\n      function _createClass(Constructor, protoProps, staticProps) {\n        if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n        if (staticProps) _defineProperties(Constructor, staticProps);\n        Object.defineProperty(Constructor, \"prototype\", {\n          writable: false\n        });\n        return Constructor;\n      }\n      function _classCallCheck(instance, Constructor) {\n        if (!(instance instanceof Constructor)) {\n          throw new TypeError(\"Cannot call a class as a function\");\n        }\n      }\n      function _inherits(subClass, superClass) {\n        if (typeof superClass !== \"function\" && superClass !== null) {\n          throw new TypeError(\"Super expression must either be null or a function\");\n        }\n        subClass.prototype = Object.create(superClass && superClass.prototype, {\n          constructor: {\n            value: subClass,\n            writable: true,\n            configurable: true\n          }\n        });\n        Object.defineProperty(subClass, \"prototype\", {\n          writable: false\n        });\n        if (superClass) _setPrototypeOf(subClass, superClass);\n      }\n      function _createSuper(Derived) {\n        var hasNativeReflectConstruct = _isNativeReflectConstruct();\n        return function _createSuperInternal() {\n          var Super = _getPrototypeOf(Derived),\n            result;\n          if (hasNativeReflectConstruct) {\n            var NewTarget = _getPrototypeOf(this).constructor;\n            result = Reflect.construct(Super, arguments, NewTarget);\n          } else {\n            result = Super.apply(this, arguments);\n          }\n          return _possibleConstructorReturn(this, result);\n        };\n      }\n      function _possibleConstructorReturn(self, call) {\n        if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n          return call;\n        } else if (call !== void 0) {\n          throw new TypeError(\"Derived constructors may only return object or undefined\");\n        }\n        return _assertThisInitialized(self);\n      }\n      function _assertThisInitialized(self) {\n        if (self === void 0) {\n          throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n        }\n        return self;\n      }\n      function _wrapNativeSuper(Class) {\n        var _cache = typeof Map === \"function\" ? new Map() : undefined;\n        _wrapNativeSuper = function _wrapNativeSuper(Class) {\n          if (Class === null || !_isNativeFunction(Class)) return Class;\n          if (typeof Class !== \"function\") {\n            throw new TypeError(\"Super expression must either be null or a function\");\n          }\n          if (typeof _cache !== \"undefined\") {\n            if (_cache.has(Class)) return _cache.get(Class);\n            _cache.set(Class, Wrapper);\n          }\n          function Wrapper() {\n            return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n          }\n          Wrapper.prototype = Object.create(Class.prototype, {\n            constructor: {\n              value: Wrapper,\n              enumerable: false,\n              writable: true,\n              configurable: true\n            }\n          });\n          return _setPrototypeOf(Wrapper, Class);\n        };\n        return _wrapNativeSuper(Class);\n      }\n      function _construct(Parent, args, Class) {\n        if (_isNativeReflectConstruct()) {\n          _construct = Reflect.construct;\n        } else {\n          _construct = function _construct(Parent, args, Class) {\n            var a = [null];\n            a.push.apply(a, args);\n            var Constructor = Function.bind.apply(Parent, a);\n            var instance = new Constructor();\n            if (Class) _setPrototypeOf(instance, Class.prototype);\n            return instance;\n          };\n        }\n        return _construct.apply(null, arguments);\n      }\n      function _isNativeReflectConstruct() {\n        if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n        if (Reflect.construct.sham) return false;\n        if (typeof Proxy === \"function\") return true;\n        try {\n          Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n          return true;\n        } catch (e) {\n          return false;\n        }\n      }\n      function _isNativeFunction(fn) {\n        return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n      }\n      function _setPrototypeOf(o, p) {\n        _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n          o.__proto__ = p;\n          return o;\n        };\n        return _setPrototypeOf(o, p);\n      }\n      function _getPrototypeOf(o) {\n        _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n          return o.__proto__ || Object.getPrototypeOf(o);\n        };\n        return _getPrototypeOf(o);\n      }\n      var UploadApiError = /*#__PURE__*/function (_Error) {\n        _inherits(UploadApiError, _Error);\n        var _super = _createSuper(UploadApiError);\n        function UploadApiError(response) {\n          var _this;\n          _classCallCheck(this, UploadApiError);\n          _this = _super.call(this, response.error.message);\n          _this.errorCode = response.error.code;\n          _this.details = response.error.details;\n          return _this;\n        }\n        return _createClass(UploadApiError);\n      }(/*#__PURE__*/_wrapNativeSuper(Error));\n      ; // CONCATENATED MODULE: ./src/Upload.ts\n      function Upload_rethrow(thrown, value) {\n        if (thrown) throw value;\n        return value;\n      }\n      function Upload_finallyRethrows(body, finalizer) {\n        try {\n          var result = body();\n        } catch (e) {\n          return finalizer(true, e);\n        }\n        if (result && result.then) {\n          return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n        }\n        return finalizer(false, result);\n      }\n      function _continueIgnored(value) {\n        if (value && value.then) {\n          return value.then(Upload_empty);\n        }\n      }\n      function _toConsumableArray(arr) {\n        return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n      }\n      function _nonIterableSpread() {\n        throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n      }\n      function _unsupportedIterableToArray(o, minLen) {\n        if (!o) return;\n        if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n        var n = Object.prototype.toString.call(o).slice(8, -1);\n        if (n === \"Object\" && o.constructor) n = o.constructor.name;\n        if (n === \"Map\" || n === \"Set\") return Array.from(o);\n        if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n      }\n      function _iterableToArray(iter) {\n        if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n      }\n      function _arrayWithoutHoles(arr) {\n        if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n      }\n      function _arrayLikeToArray(arr, len) {\n        if (len == null || len > arr.length) len = arr.length;\n        for (var i = 0, arr2 = new Array(len); i < len; i++) {\n          arr2[i] = arr[i];\n        }\n        return arr2;\n      }\n      function Upload_empty() {}\n      var accountIdLength = 7; // Sync with: upload/shared/**/AccountIdUtils\n\n      function Upload_awaitIgnored(value, direct) {\n        if (!direct) {\n          return value && value.then ? value.then(Upload_empty) : Promise.resolve();\n        }\n      }\n      var specialApiKeyAccountId = \"W142hJk\";\n      function Upload_async(f) {\n        return function () {\n          for (var args = [], i = 0; i < arguments.length; i++) {\n            args[i] = arguments[i];\n          }\n          try {\n            return Promise.resolve(f.apply(this, args));\n          } catch (e) {\n            return Promise.reject(e);\n          }\n        };\n      }\n      var specialApiKeys = [\"free\", \"demo\"];\n      function _await(value, then, direct) {\n        if (direct) {\n          return then ? then(value) : value;\n        }\n        if (!value || !value.then) {\n          value = Promise.resolve(value);\n        }\n        return then ? value.then(then) : value;\n      }\n      var apiKeyPrefix = \"public_\";\n      function Upload_call(body, then, direct) {\n        if (direct) {\n          return then ? then(body()) : body();\n        }\n        try {\n          var result = Promise.resolve(body());\n          return then ? result.then(then) : result;\n        } catch (e) {\n          return Promise.reject(e);\n        }\n      }\n      var maxUploadConcurrency = 5;\n      function _callIgnored(body, direct) {\n        return Upload_call(body, Upload_empty, direct);\n      }\n      var refreshBeforeExpirySeconds = 20;\n      function _catch(body, recover) {\n        try {\n          var result = body();\n        } catch (e) {\n          return recover(e);\n        }\n        if (result && result.then) {\n          return result.then(void 0, recover);\n        }\n        return result;\n      }\n      var onProgressInterval = 100;\n      function _invokeIgnored(body) {\n        var result = body();\n        if (result && result.then) {\n          return result.then(Upload_empty);\n        }\n      }\n      var retryAuthAfterErrorSeconds = 5;\n      var minJwtTtlSeconds = 10;\n      var maxJwtTtlSeconds = 2147483; // Max value for window.setTimeout is 2147483647ms -- if we go over this, the timeout fires immediately.\n\n      var accessTokenPathBase = \"/api/v1/access_tokens/\";\n      var logPrefix = \"[upload-js] \";\n      /**\n       * You should instantiate one instance of this class in your web app.\n       *\n       * Try using:\n       *\n       *    Upload({apiKey: \"free\"})\n       *\n       * If multiple instances exist, then all '*AuthSession' calls will be forwarded to the first instance that had an\n       * '*AuthSession' call invoked on it.\n       */\n\n      function Upload(config) {\n        // ----------------\n        // READONLY MEMBERS\n        // ----------------\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        var accountId;\n        var authMutex = Mutex();\n        var apiUrl = (_b = (_a = config.internal) === null || _a === void 0 ? void 0 : _a.apiUrl) !== null && _b !== void 0 ? _b : \"https://api.bytescale.com\";\n        var cdnUrl = (_d = (_c = config.internal) === null || _c === void 0 ? void 0 : _c.cdnUrl) !== null && _d !== void 0 ? _d : \"https://upcdn.io\";\n        var authenticateWithApiKey = (_f = (_e = config.internal) === null || _e === void 0 ? void 0 : _e.authenticateWithApiKey) !== null && _f !== void 0 ? _f : true;\n        var headers = (_g = config.internal) === null || _g === void 0 ? void 0 : _g.headers;\n        var debugMode = config.debug === true;\n        var wasCalled = \" was called.\"; // ------------------\n        // READ/WRITE MEMBERS\n        // ------------------\n\n        var lastAuthSession; // ----------------\n        // CONSTRUCTOR\n        // ----------------\n\n        if ((config !== null && config !== void 0 ? config : undefined) === undefined) {\n          throw new Error(\"\".concat(logPrefix, \"Config parameter required.\"));\n        }\n        if (config.debug === true) {\n          console.log(\"\".concat(logPrefix, \"Initialized with API key '\").concat(config.apiKey, \"'\"));\n        }\n        if (((_h = config.apiKey) !== null && _h !== void 0 ? _h : undefined) === undefined) {\n          throw new Error(\"\".concat(logPrefix, \"Please provide an API key via the 'apiKey' config parameter.\"));\n        }\n        if (config.apiKey.trim() !== config.apiKey) {\n          // We do not support API keys with whitespace (by trimming ourselves) because otherwise we'd need to support this\n          // everywhere in perpetuity (since removing the trimming would be a breaking change).\n          throw new Error(\"\".concat(logPrefix, \"API key needs trimming (whitespace detected).\"));\n        } // Non-api-key authentication is required by Bytescale Dashboard, which uses bearer tokens instead of API keys because\n        // the user may not have any active API keys, but might still want to upload files via the Bytescale Dashboard.\n\n        if (((_j = config.internal) === null || _j === void 0 ? void 0 : _j.authenticateWithApiKey) === false) {\n          accountId = config.internal.accountId;\n        } else {\n          if (specialApiKeys.includes(config.apiKey)) {\n            accountId = specialApiKeyAccountId;\n          } else {\n            if (!config.apiKey.startsWith(apiKeyPrefix)) {\n              throw new Error(\"\".concat(logPrefix, \"API key must begin with \\\"\").concat(apiKeyPrefix, \"\\\".\"));\n            }\n            accountId = config.apiKey.substr(apiKeyPrefix.length, accountIdLength);\n            if (accountId.length !== accountIdLength) {\n              throw new Error(\"\".concat(logPrefix, \"API key is too short!\"));\n            }\n          }\n        }\n        var accessTokenUrl = \"\".concat(cdnUrl).concat(accessTokenPathBase).concat(accountId); // ----------------\n        // PUBLIC METHODS\n        // ----------------\n\n        var beginAuthSession = Upload_async(function (authUrl, authHeaders) {\n          return Upload_awaitIgnored(callAuthMethod(Upload_async(function (x) {\n            return x.beginAuthSession(authUrl, authHeaders);\n          }), Upload_async(function () {\n            debug(\"'beginAuthSession'\".concat(wasCalled)); // Explanation:\n            // - Prevents restarting the auth session on accidental double-calls to 'beginAuthSession': in some users' code,\n            //   this happens accidentally every second, so we want to bail-out if we detect this is occurring.\n            // - We only check 'authUrl' to determine if the 'same call' is being made, since 'authHeaders' is a function\n            //   and therefore its body can be switched-out by the user's code if they desire a change to its behaviour, so\n            //   don't need to call 'beginAuthSession' just to update it.\n\n            if ((lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.authUrl) === authUrl) {\n              error(\"'beginAuthSession' already called. Ignoring this call. Hint: call 'endAuthSession' and then 'beginAuthSession' if you want to restart the auth session.\");\n              return;\n            }\n            return Upload_call(doEndAuthSession, function () {\n              var authSession = {\n                accessToken: undefined,\n                accessTokenRefreshHandle: undefined,\n                isActive: true,\n                authUrl: authUrl\n              }; // Does not need to be inside the mutex since the environment is single-threaded, and we have not async-yielded\n              // since the mutex from 'endAuthSession' was relinquished (meaning we still have execution,\n              // so we know a) nothing can interject and b) nothing has interjected since the lock was relinquished).\n\n              lastAuthSession = authSession;\n              return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n            });\n          })));\n        });\n        var endAuthSession = Upload_async(function () {\n          return Upload_awaitIgnored(callAuthMethod(Upload_async(function (x) {\n            return x.endAuthSession();\n          }), Upload_async(function () {\n            debug(\"'endAuthSession'\".concat(wasCalled));\n            return _callIgnored(doEndAuthSession);\n          })));\n        });\n        var uploadFile = Upload_async(function (file) {\n          var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n          debug(\"'uploadFile'\".concat(wasCalled)); // Initial progress (raised immediately and synchronously).\n\n          var cancellationHandlers = [];\n          var addCancellationHandler = function addCancellationHandler(ca) {\n            cancellationHandlers.push(ca);\n          };\n          var cancel = function cancel() {\n            return cancellationHandlers.forEach(function (x) {\n              return x();\n            });\n          };\n          if (params.onBegin !== undefined) {\n            params.onBegin({\n              cancel: cancel\n            });\n          }\n          return _catch(function () {\n            return _await(beginFileUpload(file, params, addCancellationHandler));\n          }, function (e) {\n            cancel();\n            throw e;\n          });\n        });\n        var url = function url(filePath, transformationOrParams) {\n          var _a;\n          var defaultSlug = \"raw\";\n          var params = typeof transformationOrParams === \"string\" ? {\n            transformation: transformationOrParams\n          } : transformationOrParams;\n          return \"\".concat(cdnUrl, \"/\").concat(accountId, \"/\").concat((_a = params === null || params === void 0 ? void 0 : params.transformation) !== null && _a !== void 0 ? _a : defaultSlug).concat(filePath).concat((params === null || params === void 0 ? void 0 : params.auth) === true ? \"?_auth=true\" : \"\");\n        };\n        var self = {\n          beginAuthSession: beginAuthSession,\n          endAuthSession: endAuthSession,\n          uploadFile: uploadFile,\n          url: url\n        }; // ----------------\n        // PRIVATE METHODS\n        // ----------------\n\n        var doEndAuthSession = Upload_async(function () {\n          return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n            if (lastAuthSession === undefined) {\n              return;\n            }\n            var authSession = lastAuthSession;\n            lastAuthSession = undefined;\n            if (authSession.accessTokenRefreshHandle !== undefined) {\n              clearTimeout(authSession.accessTokenRefreshHandle);\n            }\n            authSession.isActive = false;\n            return _callIgnored(deleteAccessToken);\n          })));\n        });\n        var beginFileUpload = Upload_async(function (file, params, addCancellationHandler) {\n          var progressSmoother = (0, external_progress_smoother_namespaceObject.ProgressSmoother)({\n            maxValue: file.size,\n            teardownTime: 1000,\n            minDelayUntilFirstValue: 2000,\n            valueIncreaseDelta: 200 * 1024,\n            valueIncreaseRatePerSecond: 50 * 1024,\n            averageTimeBetweenValues: 1000 // When running, XHR should (hopefully) report at least every second, regardless of connection speed.\n          });\n          var reportProgress = function reportProgress(stopReportingProgress) {\n            if (params.onProgress === undefined) {\n              stopReportingProgress(); // Important to call this, as outer function awaits this call when the download ends.\n            } else {\n              var bytesSent = progressSmoother.smoothedValue();\n              var bytesTotal = file.size;\n              if (bytesSent === bytesTotal) {\n                stopReportingProgress();\n              }\n              params.onProgress({\n                bytesSent: bytesSent,\n                bytesTotal: bytesTotal,\n                progress: Math.round(bytesSent / bytesTotal * 100)\n              });\n            }\n          };\n          return withProgressReporting(onProgressInterval, reportProgress, Upload_async(function () {\n            var uploadRequest = {\n              path: params.path,\n              metadata: params.metadata,\n              mime: normalizeMimeType(file.type),\n              originalFileName: file.name,\n              protocol: \"1.1\",\n              size: file.size,\n              tags: params.tags\n            };\n            debug(\"Initiating file upload. Params = \".concat(JSON.stringify(uploadRequest)));\n            return _await((0, upload_api_client_upload_js_namespaceObject.beginMultipartUpload)(getConfig(), accountId, uploadRequest), function (_beginMultipartUpload) {\n              var uploadMetadata = handleApiResult(_beginMultipartUpload);\n              debug(\"Initiated file upload. Metadata = \".concat(JSON.stringify(uploadMetadata)));\n              var incUploadIndex = function () {\n                var lastUploadIndex = 0;\n                return function () {\n                  if (lastUploadIndex === uploadMetadata.uploadParts.count - 1) {\n                    return undefined;\n                  }\n                  return ++lastUploadIndex;\n                };\n              }();\n              var nextPartQueue = [uploadMetadata.uploadParts.first];\n              var getNextPart = Upload_async(function (workerIndex) {\n                var nextPart = nextPartQueue.pop();\n                if (nextPart !== undefined) {\n                  debug(\"Dequeued part \".concat(nextPart.uploadPartIndex, \".\"), workerIndex);\n                  return nextPart;\n                }\n                var uploadPartIndex = incUploadIndex();\n                if (uploadPartIndex === undefined) {\n                  debug(\"No parts remaining.\", workerIndex);\n                  return undefined;\n                }\n                debug(\"Fetching metadata for part \".concat(uploadPartIndex, \".\"), workerIndex);\n                return _await((0, upload_api_client_upload_js_namespaceObject.getUploadPart)(getConfig(), accountId, uploadMetadata.uploadId, uploadPartIndex), handleApiResult);\n              });\n              var bytesSentByEachWorker = [];\n              var uploadNextPart = function uploadNextPart(workerIndex) {\n                return _await(getNextPart(workerIndex), function (nextPart) {\n                  return _invokeIgnored(function () {\n                    if (nextPart !== undefined) {\n                      var lastBytesSent = 0;\n                      var progress = function progress(_ref) {\n                        var bytesSent = _ref.bytesSent;\n                        if (bytesSentByEachWorker[workerIndex] === undefined) {\n                          bytesSentByEachWorker[workerIndex] = bytesSent;\n                        } else {\n                          bytesSentByEachWorker[workerIndex] -= lastBytesSent;\n                          bytesSentByEachWorker[workerIndex] += bytesSent;\n                        }\n                        lastBytesSent = bytesSent;\n                        var totalBytesSent = bytesSentByEachWorker.reduce(function (a, b) {\n                          return a + b;\n                        });\n                        progressSmoother.setValue(totalBytesSent);\n                      };\n                      return _await(uploadPart(file, nextPart, progress, addCancellationHandler, workerIndex), function () {\n                        return Upload_awaitIgnored(uploadNextPart(workerIndex));\n                      });\n                    }\n                  });\n                });\n              };\n              return _await(Promise.all(_toConsumableArray(Array(maxUploadConcurrency).keys()).map(function (workerIndex) {\n                return _await(uploadNextPart(workerIndex));\n              })), function () {\n                var uploadedFile = Object.assign({\n                  accountId: accountId,\n                  file: file\n                }, uploadMetadata.file);\n                debug(\"File upload completed.\");\n                return uploadedFile;\n              });\n            });\n          }));\n        });\n        var putUploadPart = Upload_async(function (url, content, progress, addCancellationHandler) {\n          var xhr = new XMLHttpRequest();\n          var pending = true;\n          addCancellationHandler(function () {\n            if (pending) {\n              xhr.abort();\n            }\n          });\n          return Upload_finallyRethrows(function () {\n            return _await(new Promise(function (resolve, reject) {\n              xhr.upload.addEventListener(\"progress\", function (evt) {\n                if (evt.lengthComputable) {\n                  progress({\n                    bytesSent: evt.loaded,\n                    bytesTotal: evt.total\n                  });\n                }\n              }, false);\n              xhr.addEventListener(\"load\", function () {\n                // Ensure we always report the progress of a finished upload as 100%.\n                progress({\n                  bytesSent: content.size,\n                  bytesTotal: content.size\n                });\n                if (Math.floor(xhr.status / 100) === 2) {\n                  var etag = xhr.getResponseHeader(\"etag\");\n                  if (etag === null || etag === undefined) {\n                    reject(new Error(\"File upload error: no etag header in upload response.\"));\n                  } else {\n                    resolve({\n                      etag: etag\n                    });\n                  }\n                } else {\n                  reject(new Error(\"File upload error: status code \".concat(xhr.status)));\n                }\n              });\n              xhr.onabort = function () {\n                return reject(new Error(\"File upload cancelled.\"));\n              };\n              xhr.onerror = function () {\n                return reject(new Error(\"File upload error.\"));\n              };\n              xhr.ontimeout = function () {\n                return reject(new Error(\"File upload timeout.\"));\n              };\n              xhr.open(\"PUT\", url);\n              xhr.send(content);\n            }));\n          }, function (_wasThrown, _result) {\n            pending = false;\n            return Upload_rethrow(_wasThrown, _result);\n          });\n        });\n        var uploadPart = Upload_async(function (file, part, progress, addCancellationHandler, workerIndex) {\n          var content = part.range.inclusiveEnd === -1 ? new Blob() : file.slice(part.range.inclusiveStart, part.range.inclusiveEnd + 1);\n          debug(\"Uploading part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n          return _await(putUploadPart(part.uploadUrl, content, progress, addCancellationHandler), function (_ref2) {\n            var etag = _ref2.etag;\n            return _await((0, upload_api_client_upload_js_namespaceObject.completeUploadPart)(getConfig(), accountId, part.uploadId, part.uploadPartIndex, {\n              etag: etag\n            }), function (_completeUploadPart) {\n              handleApiResult(_completeUploadPart);\n              debug(\"Uploaded part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n            });\n          });\n        });\n        var withProgressReporting = Upload_async(function (tickInterval, tick, scope) {\n          var whileReportingResolved;\n          var whileReporting = new Promise(function (resolve) {\n            whileReportingResolved = resolve;\n          });\n          var isReporting = true;\n          var stopReporting = function stopReporting() {\n            if (isReporting) {\n              whileReportingResolved();\n              clearInterval(intervalHandle);\n              isReporting = false;\n            }\n          };\n          var intervalHandle = setInterval(function () {\n            return tick(stopReporting);\n          }, tickInterval);\n          return Upload_finallyRethrows(function () {\n            return Upload_call(scope, function (result) {\n              return _await(whileReporting, function () {\n                return result;\n              });\n            });\n          }, function (_wasThrown2, _result2) {\n            stopReporting();\n            return Upload_rethrow(_wasThrown2, _result2);\n          });\n        });\n        var deleteAccessToken = Upload_async(function () {\n          return Upload_awaitIgnored(deleteNoResponse(accessTokenUrl, {}, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n          ));\n        });\n        /**\n         * Calls the given auth method on the canonical auth instance.\n         */\n\n        var callAuthMethod = Upload_async(function (other, me) {\n          var authInstance = getAuthInstance();\n          return _invokeIgnored(function () {\n            if (authInstance !== self) {\n              // Forward call to global auth instance.\n              return Upload_awaitIgnored(other(authInstance));\n            } else {\n              return _callIgnored(me);\n            }\n          });\n        });\n        /**\n         * Returns a single global instance of Upload.js for all auth calls.\n         * If we require multiple instances in the future, we can provide a parameter to disable this behaviour.\n         */\n\n        var getAuthInstance = function getAuthInstance() {\n          var globalKey = \"uploadJsAuthInstance\";\n          var globalAuthInstance = window[globalKey];\n          if (globalAuthInstance === undefined) {\n            globalAuthInstance = self;\n            window[globalKey] = self;\n          }\n          return globalAuthInstance;\n        };\n        var refreshAccessToken = Upload_async(function (authUrl, authHeaders, authSession) {\n          return _continueIgnored(_catch(function () {\n            return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n              // Session may have been ended while timer was waiting.\n              if (!authSession.isActive) {\n                return;\n              }\n              return Upload_call(authHeaders, function (_authHeaders) {\n                return _await(getAccessToken(authUrl, _authHeaders), function (token) {\n                  return _await(putJsonGetJson(accessTokenUrl, {}, {\n                    accessToken: token\n                  }, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n                  ), function (setTokenResult) {\n                    var desiredTtlSeconds = setTokenResult.ttlSeconds - refreshBeforeExpirySeconds;\n                    if (desiredTtlSeconds < minJwtTtlSeconds) {\n                      warn(\"JWT expiration is too short: waiting for \".concat(minJwtTtlSeconds, \" seconds before refreshing.\"));\n                    }\n                    authSession.accessToken = setTokenResult.accessToken;\n                    authSession.accessTokenRefreshHandle = window.setTimeout(function () {\n                      refreshAccessToken(authUrl, authHeaders, authSession).then(function () {}, function (e) {\n                        return error(\"Permanent error when refreshing access token: \".concat(e));\n                      });\n                    }, Math.min(maxJwtTtlSeconds, Math.max(minJwtTtlSeconds, desiredTtlSeconds)) * 1000);\n                  });\n                });\n              });\n            })));\n          }, function (e) {\n            // Use 'error' instead of 'debug' so that the user sees error messages.\n            error(\"Error when refreshing access token: \".concat(e)); // Perform attempts as part of same promise, rather than via a 'setTimeout' so that the 'beginAuthSession' only\n            // returns once an auth session has been successfully established.\n\n            return _await(new Promise(function (resolve) {\n              return setTimeout(resolve, retryAuthAfterErrorSeconds * 1000);\n            }), function () {\n              // Todo: is this stack safe?\n              return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n            });\n          }));\n        });\n        var putJsonGetJson = Upload_async(function (url, headers, requestBody, withCredentials) {\n          return _await(nonUploadApiRequest({\n            method: \"PUT\",\n            path: url,\n            headers: headers,\n            body: requestBody\n          }, withCredentials), function (_nonUploadApiRequest) {\n            return _await(handleApiResult(_nonUploadApiRequest));\n          });\n        });\n        var getAccessToken = Upload_async(function (authUrl, headers) {\n          var endpointName = \"Your auth API endpoint\";\n          return _await(nonUploadApiRequest({\n            method: \"GET\",\n            path: authUrl,\n            headers: headers\n          }, false), function (result) {\n            if (!result.ok) {\n              throw new Error(\"\".concat(logPrefix).concat(endpointName, \" returned a failed response. Please ensure the endpoint's status code is 200.\"));\n            }\n            var jwt = result.body;\n            if (typeof jwt !== \"string\") {\n              // We will receive 'null' if there was no content-type response header.\n              throw new Error(\"\".concat(logPrefix).concat(endpointName, \" returned an unsupported response. Please ensure: 1) 'Content-Type: text/plain' is in the HTTP response headers 2) the status code is 200.\"));\n            }\n            if (jwt.length === 0) {\n              throw new Error(\"\".concat(logPrefix).concat(endpointName, \" returned an empty string. Please return a valid JWT instead.\"));\n            }\n            if (jwt.trim().length !== jwt.length) {\n              // Whitespace can be a nightmare to spot/debug, so we fail early here.\n              throw new Error(\"\".concat(logPrefix).concat(endpointName, \" returned whitespace around the JWT, please remove it.\"));\n            }\n            return jwt;\n          });\n        });\n        var deleteNoResponse = Upload_async(function (url, headers, withCredentials) {\n          return _await(nonUploadApiRequest({\n            method: \"DELETE\",\n            path: url,\n            headers: headers\n          }, withCredentials), function (_nonUploadApiRequest2) {\n            handleApiResult(_nonUploadApiRequest2);\n          });\n        });\n        var handleApiResult = function handleApiResult(result) {\n          var _a;\n          if (result.ok) {\n            return result.body;\n          }\n          var errorResponseMaybe = result.body;\n          if (typeof ((_a = errorResponseMaybe === null || errorResponseMaybe === void 0 ? void 0 : errorResponseMaybe.error) === null || _a === void 0 ? void 0 : _a.code) === \"string\") {\n            throw new UploadApiError(errorResponseMaybe);\n          }\n          throw new Error(\"\".concat(logPrefix, \"Network error. If problem persists, and your network connectivity is healthy, please contact support@bytescale.com and provide: (a) time of failed request in UTC (b) screenshot of failed network response body (c) screenshot of failed network response header (d) browser + version.\"));\n        };\n        var nonUploadApiRequest = Upload_async(function (options, withCredentials) {\n          return (0, upload_api_client_upload_js_namespaceObject.request)({\n            BASE: options.path,\n            WITH_CREDENTIALS: withCredentials\n          }, Object.assign(Object.assign({}, options), {\n            path: \"\" // We set to \"\" because we're using \"BASE\" above instead.\n          }));\n        });\n        var getConfig = function getConfig() {\n          var apiConfig = {\n            BASE: apiUrl,\n            WITH_CREDENTIALS: true\n          };\n          if (authenticateWithApiKey) {\n            apiConfig.USERNAME = \"apikey\";\n            apiConfig.PASSWORD = config.apiKey;\n          }\n          var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken;\n          if (headers !== undefined || accessToken !== undefined) {\n            apiConfig.HEADERS = Upload_async(function () {\n              return _await(headers === undefined ? {} : headers(), function (headersFromConfig) {\n                var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken; // Re-fetch as there's been an async boundary so state may have changed.\n\n                return Object.assign(Object.assign({}, headersFromConfig), accessToken === undefined ? {} : {\n                  \"authorization-token\": accessToken\n                });\n              }, headers === undefined);\n            });\n          }\n          return apiConfig;\n        };\n        var normalizeMimeType = function normalizeMimeType(mime) {\n          var normal = mime.toLowerCase();\n          var regex = /^[a-z0-9]+\\/[a-z0-9+\\-._]+(?:;[^=]+=[^;]+)*$/; // Sync with 'MimeTypeUnboxed' in 'upload/api'.\n\n          return regex.test(normal) ? normal : undefined;\n        };\n        var debug = function debug(message, workerIndex) {\n          if (debugMode) {\n            console.log(\"\".concat(logPrefix).concat(message).concat(workerIndex !== undefined ? \" (Worker \".concat(workerIndex, \")\") : \"\"));\n          }\n        };\n        var error = function error(message) {\n          console.error(\"\".concat(logPrefix).concat(message));\n        };\n        var warn = function warn(message) {\n          console.warn(\"\".concat(logPrefix).concat(message));\n        };\n        return self;\n      }\n      ; // CONCATENATED MODULE: ./src/index.ts\n\n      /***/\n    })\n\n    /******/\n  };\n  /************************************************************************/\n  /******/ // The module cache\n  /******/\n  var __webpack_module_cache__ = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/ // Check if module is in cache\n    /******/if (__webpack_module_cache__[moduleId]) {\n      /******/return __webpack_module_cache__[moduleId].exports;\n      /******/\n    }\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = __webpack_module_cache__[moduleId] = {\n      /******/ // no module.id needed\n      /******/ // no module.loaded needed\n      /******/exports: {}\n      /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    __webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /************************************************************************/\n  /******/ /* webpack/runtime/define property getters */\n  /******/\n  !function () {\n    /******/ // define getter functions for harmony exports\n    /******/__webpack_require__.d = function (exports, definition) {\n      /******/for (var key in definition) {\n        /******/if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n          /******/Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: definition[key]\n          });\n          /******/\n        }\n        /******/\n      }\n      /******/\n    };\n    /******/\n  }();\n  /******/\n  /******/ /* webpack/runtime/hasOwnProperty shorthand */\n  /******/\n  !function () {\n    /******/__webpack_require__.o = function (obj, prop) {\n      return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n    /******/\n  }();\n  /******/\n  /******/ /* webpack/runtime/make namespace object */\n  /******/\n  !function () {\n    /******/ // define __esModule on exports\n    /******/__webpack_require__.r = function (exports) {\n      /******/if (typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n        /******/Object.defineProperty(exports, Symbol.toStringTag, {\n          value: 'Module'\n        });\n        /******/\n      }\n      /******/\n      Object.defineProperty(exports, '__esModule', {\n        value: true\n      });\n      /******/\n    };\n    /******/\n  }();\n  /******/\n  /************************************************************************/\n  /******/ // module exports must be returned from runtime so entry inlining is disabled\n  /******/ // startup\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(\"./src/index.ts\");\n  /******/\n}();","map":{"version":3,"names":["module","exports","__webpack_modules__","./src/index.ts","__unused_webpack_module","__webpack_exports__","__webpack_require__","r","d","Upload","UploadApiError","upload_api_client_upload_js_namespaceObject","require","_call","body","then","direct","result","Promise","resolve","e","reject","_rethrow","thrown","value","_finallyRethrows","finalizer","bind","_empty","_awaitIgnored","_settle","pact","state","s","_Pact","v","o","observer","prototype","onFulfilled","onRejected","callback","_this","_isSettledPact","thenable","_for","test","update","stage","shouldContinue","updateValue","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","_continue","_async","f","args","i","arguments","length","apply","Mutex","mutex","resolver","safe","acquire","_wasThrown","_result","release","undefined","Error","external_progress_smoother_namespaceObject","_typeof","obj","Symbol","iterator","constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","_inherits","subClass","superClass","create","_setPrototypeOf","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","NewTarget","Reflect","construct","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","_wrapNativeSuper","Class","_cache","Map","_isNativeFunction","has","get","set","Wrapper","_construct","Parent","a","push","Function","sham","Proxy","Boolean","valueOf","fn","toString","indexOf","p","setPrototypeOf","__proto__","getPrototypeOf","_Error","_super","response","error","message","errorCode","code","details","Upload_rethrow","Upload_finallyRethrows","_continueIgnored","Upload_empty","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","minLen","_arrayLikeToArray","n","slice","name","Array","from","iter","isArray","len","arr2","accountIdLength","Upload_awaitIgnored","specialApiKeyAccountId","Upload_async","specialApiKeys","_await","apiKeyPrefix","Upload_call","maxUploadConcurrency","_callIgnored","refreshBeforeExpirySeconds","_catch","recover","onProgressInterval","_invokeIgnored","retryAuthAfterErrorSeconds","minJwtTtlSeconds","maxJwtTtlSeconds","accessTokenPathBase","logPrefix","config","_a","_b","_c","_d","_e","_f","_g","_h","_j","accountId","authMutex","apiUrl","internal","cdnUrl","authenticateWithApiKey","headers","debugMode","debug","wasCalled","lastAuthSession","concat","console","log","apiKey","trim","includes","startsWith","substr","accessTokenUrl","beginAuthSession","authUrl","authHeaders","callAuthMethod","x","doEndAuthSession","authSession","accessToken","accessTokenRefreshHandle","isActive","refreshAccessToken","endAuthSession","uploadFile","file","params","cancellationHandlers","addCancellationHandler","ca","cancel","forEach","onBegin","beginFileUpload","url","filePath","transformationOrParams","defaultSlug","transformation","auth","clearTimeout","deleteAccessToken","progressSmoother","ProgressSmoother","maxValue","size","teardownTime","minDelayUntilFirstValue","valueIncreaseDelta","valueIncreaseRatePerSecond","averageTimeBetweenValues","reportProgress","stopReportingProgress","onProgress","bytesSent","smoothedValue","bytesTotal","progress","Math","round","withProgressReporting","uploadRequest","path","metadata","mime","normalizeMimeType","type","originalFileName","protocol","tags","JSON","stringify","beginMultipartUpload","getConfig","_beginMultipartUpload","uploadMetadata","handleApiResult","incUploadIndex","lastUploadIndex","uploadParts","count","nextPartQueue","first","getNextPart","workerIndex","nextPart","pop","uploadPartIndex","getUploadPart","uploadId","bytesSentByEachWorker","uploadNextPart","lastBytesSent","_ref","totalBytesSent","reduce","b","setValue","uploadPart","all","keys","map","uploadedFile","assign","putUploadPart","content","xhr","XMLHttpRequest","pending","abort","upload","addEventListener","evt","lengthComputable","loaded","total","floor","status","etag","getResponseHeader","onabort","onerror","ontimeout","open","send","part","range","inclusiveEnd","Blob","inclusiveStart","uploadUrl","_ref2","completeUploadPart","_completeUploadPart","tickInterval","tick","scope","whileReportingResolved","whileReporting","isReporting","stopReporting","clearInterval","intervalHandle","setInterval","_wasThrown2","_result2","deleteNoResponse","other","me","authInstance","getAuthInstance","globalKey","globalAuthInstance","window","_authHeaders","getAccessToken","token","putJsonGetJson","setTokenResult","desiredTtlSeconds","ttlSeconds","warn","setTimeout","min","max","requestBody","withCredentials","nonUploadApiRequest","method","_nonUploadApiRequest","endpointName","ok","jwt","_nonUploadApiRequest2","errorResponseMaybe","options","request","BASE","WITH_CREDENTIALS","apiConfig","USERNAME","PASSWORD","HEADERS","headersFromConfig","normal","toLowerCase","regex","__webpack_module_cache__","moduleId","definition","prop","hasOwnProperty","toStringTag"],"sources":["C:/943d42ef-4725-4941-9203-3c125c3e1f91-dcb72947-3cb2-415c-bcca-9a1770712250/reactapp/node_modules/upload-js/dist/main.js"],"sourcesContent":["module.exports =\n/******/ (function() { // webpackBootstrap\n/******/ \t\"use strict\";\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ \"./src/index.ts\":\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"Upload\": function() { return /* reexport */ Upload; },\n  \"UploadApiError\": function() { return /* reexport */ UploadApiError; }\n});\n\n;// CONCATENATED MODULE: external \"@upload-io/upload-api-client-upload-js\"\nvar upload_api_client_upload_js_namespaceObject = require(\"@upload-io/upload-api-client-upload-js\");;\n;// CONCATENATED MODULE: ./src/Mutex.ts\n/**\n * A lightweight mutex. (Other libraries contain too many features and we want to keep the size upload-js down).\n *\n * Characteristics:\n * - Non-reentrant.\n * - Unfair. (Multiple callers awaiting 'acquire' will be granted the mutex in no order.)\n *   - When calling `safe` consecutively with no 'awaits' in-between, the current context will synchronously acquire\n *     the mutex every time.\n */\nfunction _call(body, then, direct) {\n  if (direct) {\n    return then ? then(body()) : body();\n  }\n\n  try {\n    var result = Promise.resolve(body());\n    return then ? result.then(then) : result;\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\n\nfunction _rethrow(thrown, value) {\n  if (thrown) throw value;\n  return value;\n}\n\nfunction _finallyRethrows(body, finalizer) {\n  try {\n    var result = body();\n  } catch (e) {\n    return finalizer(true, e);\n  }\n\n  if (result && result.then) {\n    return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n  }\n\n  return finalizer(false, result);\n}\n\nfunction _empty() {}\n\nfunction _awaitIgnored(value, direct) {\n  if (!direct) {\n    return value && value.then ? value.then(_empty) : Promise.resolve();\n  }\n}\n\nfunction _settle(pact, state, value) {\n  if (!pact.s) {\n    if (value instanceof _Pact) {\n      if (value.s) {\n        if (state & 1) {\n          state = value.s;\n        }\n\n        value = value.v;\n      } else {\n        value.o = _settle.bind(null, pact, state);\n        return;\n      }\n    }\n\n    if (value && value.then) {\n      value.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n      return;\n    }\n\n    pact.s = state;\n    pact.v = value;\n    var observer = pact.o;\n\n    if (observer) {\n      observer(pact);\n    }\n  }\n}\n\nvar _Pact = /*#__PURE__*/function () {\n  function _Pact() {}\n\n  _Pact.prototype.then = function (onFulfilled, onRejected) {\n    var result = new _Pact();\n    var state = this.s;\n\n    if (state) {\n      var callback = state & 1 ? onFulfilled : onRejected;\n\n      if (callback) {\n        try {\n          _settle(result, 1, callback(this.v));\n        } catch (e) {\n          _settle(result, 2, e);\n        }\n\n        return result;\n      } else {\n        return this;\n      }\n    }\n\n    this.o = function (_this) {\n      try {\n        var value = _this.v;\n\n        if (_this.s & 1) {\n          _settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n        } else if (onRejected) {\n          _settle(result, 1, onRejected(value));\n        } else {\n          _settle(result, 2, value);\n        }\n      } catch (e) {\n        _settle(result, 2, e);\n      }\n    };\n\n    return result;\n  };\n\n  return _Pact;\n}();\n\nfunction _isSettledPact(thenable) {\n  return thenable instanceof _Pact && thenable.s & 1;\n}\n\nfunction _for(test, update, body) {\n  var stage;\n\n  for (;;) {\n    var shouldContinue = test();\n\n    if (_isSettledPact(shouldContinue)) {\n      shouldContinue = shouldContinue.v;\n    }\n\n    if (!shouldContinue) {\n      return result;\n    }\n\n    if (shouldContinue.then) {\n      stage = 0;\n      break;\n    }\n\n    var result = body();\n\n    if (result && result.then) {\n      if (_isSettledPact(result)) {\n        result = result.s;\n      } else {\n        stage = 1;\n        break;\n      }\n    }\n\n    if (update) {\n      var updateValue = update();\n\n      if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n        stage = 2;\n        break;\n      }\n    }\n  }\n\n  var pact = new _Pact();\n\n  var reject = _settle.bind(null, pact, 2);\n\n  (stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n  return pact;\n\n  function _resumeAfterBody(value) {\n    result = value;\n\n    do {\n      if (update) {\n        updateValue = update();\n\n        if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n          updateValue.then(_resumeAfterUpdate).then(void 0, reject);\n          return;\n        }\n      }\n\n      shouldContinue = test();\n\n      if (!shouldContinue || _isSettledPact(shouldContinue) && !shouldContinue.v) {\n        _settle(pact, 1, result);\n\n        return;\n      }\n\n      if (shouldContinue.then) {\n        shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n        return;\n      }\n\n      result = body();\n\n      if (_isSettledPact(result)) {\n        result = result.v;\n      }\n    } while (!result || !result.then);\n\n    result.then(_resumeAfterBody).then(void 0, reject);\n  }\n\n  function _resumeAfterTest(shouldContinue) {\n    if (shouldContinue) {\n      result = body();\n\n      if (result && result.then) {\n        result.then(_resumeAfterBody).then(void 0, reject);\n      } else {\n        _resumeAfterBody(result);\n      }\n    } else {\n      _settle(pact, 1, result);\n    }\n  }\n\n  function _resumeAfterUpdate() {\n    if (shouldContinue = test()) {\n      if (shouldContinue.then) {\n        shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n      } else {\n        _resumeAfterTest(shouldContinue);\n      }\n    } else {\n      _settle(pact, 1, result);\n    }\n  }\n}\n\nfunction _continue(value, then) {\n  return value && value.then ? value.then(then) : then(value);\n}\n\nfunction _async(f) {\n  return function () {\n    for (var args = [], i = 0; i < arguments.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    try {\n      return Promise.resolve(f.apply(this, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nfunction Mutex() {\n  var mutex;\n  var resolver;\n\n  var safe = function safe(callback) {\n    return _call(acquire, function () {\n      return _finallyRethrows(callback, function (_wasThrown, _result) {\n        release();\n        return _rethrow(_wasThrown, _result);\n      });\n    });\n  };\n\n  var acquire = _async(function () {\n    // Loop necessary for when multiple calls are made to 'acquire' before a 'release' is called, else the call to\n    // 'release' will resume every caller currently waiting on 'acquire'.\n    // eslint-disable-next-line no-unmodified-loop-condition\n    return _continue(_for(function () {\n      return mutex !== undefined;\n    }, void 0, function () {\n      return _awaitIgnored(mutex);\n    }), function () {\n      mutex = new Promise(function (resolve) {\n        resolver = resolve;\n      });\n    });\n  });\n\n  var release = function release() {\n    if (resolver === undefined) {\n      throw new Error(\"Unable to release mutex: already released.\");\n    }\n\n    resolver();\n    resolver = undefined;\n    mutex = undefined;\n  };\n\n  return {\n    safe: safe\n  };\n}\n;// CONCATENATED MODULE: external \"progress-smoother\"\nvar external_progress_smoother_namespaceObject = require(\"progress-smoother\");;\n;// CONCATENATED MODULE: ./src/UploadApiError.ts\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nvar UploadApiError = /*#__PURE__*/function (_Error) {\n  _inherits(UploadApiError, _Error);\n\n  var _super = _createSuper(UploadApiError);\n\n  function UploadApiError(response) {\n    var _this;\n\n    _classCallCheck(this, UploadApiError);\n\n    _this = _super.call(this, response.error.message);\n    _this.errorCode = response.error.code;\n    _this.details = response.error.details;\n    return _this;\n  }\n\n  return _createClass(UploadApiError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n;// CONCATENATED MODULE: ./src/Upload.ts\nfunction Upload_rethrow(thrown, value) {\n  if (thrown) throw value;\n  return value;\n}\n\nfunction Upload_finallyRethrows(body, finalizer) {\n  try {\n    var result = body();\n  } catch (e) {\n    return finalizer(true, e);\n  }\n\n  if (result && result.then) {\n    return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n  }\n\n  return finalizer(false, result);\n}\n\nfunction _continueIgnored(value) {\n  if (value && value.then) {\n    return value.then(Upload_empty);\n  }\n}\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n\n\n\n\n\nfunction Upload_empty() {}\n\nvar accountIdLength = 7; // Sync with: upload/shared/**/AccountIdUtils\n\nfunction Upload_awaitIgnored(value, direct) {\n  if (!direct) {\n    return value && value.then ? value.then(Upload_empty) : Promise.resolve();\n  }\n}\n\nvar specialApiKeyAccountId = \"W142hJk\";\n\nfunction Upload_async(f) {\n  return function () {\n    for (var args = [], i = 0; i < arguments.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    try {\n      return Promise.resolve(f.apply(this, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nvar specialApiKeys = [\"free\", \"demo\"];\n\nfunction _await(value, then, direct) {\n  if (direct) {\n    return then ? then(value) : value;\n  }\n\n  if (!value || !value.then) {\n    value = Promise.resolve(value);\n  }\n\n  return then ? value.then(then) : value;\n}\n\nvar apiKeyPrefix = \"public_\";\n\nfunction Upload_call(body, then, direct) {\n  if (direct) {\n    return then ? then(body()) : body();\n  }\n\n  try {\n    var result = Promise.resolve(body());\n    return then ? result.then(then) : result;\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\n\nvar maxUploadConcurrency = 5;\n\nfunction _callIgnored(body, direct) {\n  return Upload_call(body, Upload_empty, direct);\n}\n\nvar refreshBeforeExpirySeconds = 20;\n\nfunction _catch(body, recover) {\n  try {\n    var result = body();\n  } catch (e) {\n    return recover(e);\n  }\n\n  if (result && result.then) {\n    return result.then(void 0, recover);\n  }\n\n  return result;\n}\n\nvar onProgressInterval = 100;\n\nfunction _invokeIgnored(body) {\n  var result = body();\n\n  if (result && result.then) {\n    return result.then(Upload_empty);\n  }\n}\n\nvar retryAuthAfterErrorSeconds = 5;\nvar minJwtTtlSeconds = 10;\nvar maxJwtTtlSeconds = 2147483; // Max value for window.setTimeout is 2147483647ms -- if we go over this, the timeout fires immediately.\n\nvar accessTokenPathBase = \"/api/v1/access_tokens/\";\nvar logPrefix = \"[upload-js] \";\n/**\n * You should instantiate one instance of this class in your web app.\n *\n * Try using:\n *\n *    Upload({apiKey: \"free\"})\n *\n * If multiple instances exist, then all '*AuthSession' calls will be forwarded to the first instance that had an\n * '*AuthSession' call invoked on it.\n */\n\nfunction Upload(config) {\n  // ----------------\n  // READONLY MEMBERS\n  // ----------------\n  var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n\n  var accountId;\n  var authMutex = Mutex();\n  var apiUrl = (_b = (_a = config.internal) === null || _a === void 0 ? void 0 : _a.apiUrl) !== null && _b !== void 0 ? _b : \"https://api.bytescale.com\";\n  var cdnUrl = (_d = (_c = config.internal) === null || _c === void 0 ? void 0 : _c.cdnUrl) !== null && _d !== void 0 ? _d : \"https://upcdn.io\";\n  var authenticateWithApiKey = (_f = (_e = config.internal) === null || _e === void 0 ? void 0 : _e.authenticateWithApiKey) !== null && _f !== void 0 ? _f : true;\n  var headers = (_g = config.internal) === null || _g === void 0 ? void 0 : _g.headers;\n  var debugMode = config.debug === true;\n  var wasCalled = \" was called.\"; // ------------------\n  // READ/WRITE MEMBERS\n  // ------------------\n\n  var lastAuthSession; // ----------------\n  // CONSTRUCTOR\n  // ----------------\n\n  if ((config !== null && config !== void 0 ? config : undefined) === undefined) {\n    throw new Error(\"\".concat(logPrefix, \"Config parameter required.\"));\n  }\n\n  if (config.debug === true) {\n    console.log(\"\".concat(logPrefix, \"Initialized with API key '\").concat(config.apiKey, \"'\"));\n  }\n\n  if (((_h = config.apiKey) !== null && _h !== void 0 ? _h : undefined) === undefined) {\n    throw new Error(\"\".concat(logPrefix, \"Please provide an API key via the 'apiKey' config parameter.\"));\n  }\n\n  if (config.apiKey.trim() !== config.apiKey) {\n    // We do not support API keys with whitespace (by trimming ourselves) because otherwise we'd need to support this\n    // everywhere in perpetuity (since removing the trimming would be a breaking change).\n    throw new Error(\"\".concat(logPrefix, \"API key needs trimming (whitespace detected).\"));\n  } // Non-api-key authentication is required by Bytescale Dashboard, which uses bearer tokens instead of API keys because\n  // the user may not have any active API keys, but might still want to upload files via the Bytescale Dashboard.\n\n\n  if (((_j = config.internal) === null || _j === void 0 ? void 0 : _j.authenticateWithApiKey) === false) {\n    accountId = config.internal.accountId;\n  } else {\n    if (specialApiKeys.includes(config.apiKey)) {\n      accountId = specialApiKeyAccountId;\n    } else {\n      if (!config.apiKey.startsWith(apiKeyPrefix)) {\n        throw new Error(\"\".concat(logPrefix, \"API key must begin with \\\"\").concat(apiKeyPrefix, \"\\\".\"));\n      }\n\n      accountId = config.apiKey.substr(apiKeyPrefix.length, accountIdLength);\n\n      if (accountId.length !== accountIdLength) {\n        throw new Error(\"\".concat(logPrefix, \"API key is too short!\"));\n      }\n    }\n  }\n\n  var accessTokenUrl = \"\".concat(cdnUrl).concat(accessTokenPathBase).concat(accountId); // ----------------\n  // PUBLIC METHODS\n  // ----------------\n\n  var beginAuthSession = Upload_async(function (authUrl, authHeaders) {\n    return Upload_awaitIgnored(callAuthMethod(Upload_async(function (x) {\n      return x.beginAuthSession(authUrl, authHeaders);\n    }), Upload_async(function () {\n      debug(\"'beginAuthSession'\".concat(wasCalled)); // Explanation:\n      // - Prevents restarting the auth session on accidental double-calls to 'beginAuthSession': in some users' code,\n      //   this happens accidentally every second, so we want to bail-out if we detect this is occurring.\n      // - We only check 'authUrl' to determine if the 'same call' is being made, since 'authHeaders' is a function\n      //   and therefore its body can be switched-out by the user's code if they desire a change to its behaviour, so\n      //   don't need to call 'beginAuthSession' just to update it.\n\n      if ((lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.authUrl) === authUrl) {\n        error(\"'beginAuthSession' already called. Ignoring this call. Hint: call 'endAuthSession' and then 'beginAuthSession' if you want to restart the auth session.\");\n        return;\n      }\n\n      return Upload_call(doEndAuthSession, function () {\n        var authSession = {\n          accessToken: undefined,\n          accessTokenRefreshHandle: undefined,\n          isActive: true,\n          authUrl: authUrl\n        }; // Does not need to be inside the mutex since the environment is single-threaded, and we have not async-yielded\n        // since the mutex from 'endAuthSession' was relinquished (meaning we still have execution,\n        // so we know a) nothing can interject and b) nothing has interjected since the lock was relinquished).\n\n        lastAuthSession = authSession;\n        return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n      });\n    })));\n  });\n\n  var endAuthSession = Upload_async(function () {\n    return Upload_awaitIgnored(callAuthMethod(Upload_async(function (x) {\n      return x.endAuthSession();\n    }), Upload_async(function () {\n      debug(\"'endAuthSession'\".concat(wasCalled));\n      return _callIgnored(doEndAuthSession);\n    })));\n  });\n\n  var uploadFile = Upload_async(function (file) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    debug(\"'uploadFile'\".concat(wasCalled)); // Initial progress (raised immediately and synchronously).\n\n    var cancellationHandlers = [];\n\n    var addCancellationHandler = function addCancellationHandler(ca) {\n      cancellationHandlers.push(ca);\n    };\n\n    var cancel = function cancel() {\n      return cancellationHandlers.forEach(function (x) {\n        return x();\n      });\n    };\n\n    if (params.onBegin !== undefined) {\n      params.onBegin({\n        cancel: cancel\n      });\n    }\n\n    return _catch(function () {\n      return _await(beginFileUpload(file, params, addCancellationHandler));\n    }, function (e) {\n      cancel();\n      throw e;\n    });\n  });\n\n  var url = function url(filePath, transformationOrParams) {\n    var _a;\n\n    var defaultSlug = \"raw\";\n    var params = typeof transformationOrParams === \"string\" ? {\n      transformation: transformationOrParams\n    } : transformationOrParams;\n    return \"\".concat(cdnUrl, \"/\").concat(accountId, \"/\").concat((_a = params === null || params === void 0 ? void 0 : params.transformation) !== null && _a !== void 0 ? _a : defaultSlug).concat(filePath).concat((params === null || params === void 0 ? void 0 : params.auth) === true ? \"?_auth=true\" : \"\");\n  };\n\n  var self = {\n    beginAuthSession: beginAuthSession,\n    endAuthSession: endAuthSession,\n    uploadFile: uploadFile,\n    url: url\n  }; // ----------------\n  // PRIVATE METHODS\n  // ----------------\n\n  var doEndAuthSession = Upload_async(function () {\n    return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n      if (lastAuthSession === undefined) {\n        return;\n      }\n\n      var authSession = lastAuthSession;\n      lastAuthSession = undefined;\n\n      if (authSession.accessTokenRefreshHandle !== undefined) {\n        clearTimeout(authSession.accessTokenRefreshHandle);\n      }\n\n      authSession.isActive = false;\n      return _callIgnored(deleteAccessToken);\n    })));\n  });\n\n  var beginFileUpload = Upload_async(function (file, params, addCancellationHandler) {\n    var progressSmoother = (0,external_progress_smoother_namespaceObject.ProgressSmoother)({\n      maxValue: file.size,\n      teardownTime: 1000,\n      minDelayUntilFirstValue: 2000,\n      valueIncreaseDelta: 200 * 1024,\n      valueIncreaseRatePerSecond: 50 * 1024,\n      averageTimeBetweenValues: 1000 // When running, XHR should (hopefully) report at least every second, regardless of connection speed.\n\n    });\n\n    var reportProgress = function reportProgress(stopReportingProgress) {\n      if (params.onProgress === undefined) {\n        stopReportingProgress(); // Important to call this, as outer function awaits this call when the download ends.\n      } else {\n        var bytesSent = progressSmoother.smoothedValue();\n        var bytesTotal = file.size;\n\n        if (bytesSent === bytesTotal) {\n          stopReportingProgress();\n        }\n\n        params.onProgress({\n          bytesSent: bytesSent,\n          bytesTotal: bytesTotal,\n          progress: Math.round(bytesSent / bytesTotal * 100)\n        });\n      }\n    };\n\n    return withProgressReporting(onProgressInterval, reportProgress, Upload_async(function () {\n      var uploadRequest = {\n        path: params.path,\n        metadata: params.metadata,\n        mime: normalizeMimeType(file.type),\n        originalFileName: file.name,\n        protocol: \"1.1\",\n        size: file.size,\n        tags: params.tags\n      };\n      debug(\"Initiating file upload. Params = \".concat(JSON.stringify(uploadRequest)));\n      return _await((0,upload_api_client_upload_js_namespaceObject.beginMultipartUpload)(getConfig(), accountId, uploadRequest), function (_beginMultipartUpload) {\n        var uploadMetadata = handleApiResult(_beginMultipartUpload);\n        debug(\"Initiated file upload. Metadata = \".concat(JSON.stringify(uploadMetadata)));\n\n        var incUploadIndex = function () {\n          var lastUploadIndex = 0;\n          return function () {\n            if (lastUploadIndex === uploadMetadata.uploadParts.count - 1) {\n              return undefined;\n            }\n\n            return ++lastUploadIndex;\n          };\n        }();\n\n        var nextPartQueue = [uploadMetadata.uploadParts.first];\n\n        var getNextPart = Upload_async(function (workerIndex) {\n          var nextPart = nextPartQueue.pop();\n\n          if (nextPart !== undefined) {\n            debug(\"Dequeued part \".concat(nextPart.uploadPartIndex, \".\"), workerIndex);\n            return nextPart;\n          }\n\n          var uploadPartIndex = incUploadIndex();\n\n          if (uploadPartIndex === undefined) {\n            debug(\"No parts remaining.\", workerIndex);\n            return undefined;\n          }\n\n          debug(\"Fetching metadata for part \".concat(uploadPartIndex, \".\"), workerIndex);\n          return _await((0,upload_api_client_upload_js_namespaceObject.getUploadPart)(getConfig(), accountId, uploadMetadata.uploadId, uploadPartIndex), handleApiResult);\n        });\n\n        var bytesSentByEachWorker = [];\n\n        var uploadNextPart = function uploadNextPart(workerIndex) {\n          return _await(getNextPart(workerIndex), function (nextPart) {\n            return _invokeIgnored(function () {\n              if (nextPart !== undefined) {\n                var lastBytesSent = 0;\n\n                var progress = function progress(_ref) {\n                  var bytesSent = _ref.bytesSent;\n\n                  if (bytesSentByEachWorker[workerIndex] === undefined) {\n                    bytesSentByEachWorker[workerIndex] = bytesSent;\n                  } else {\n                    bytesSentByEachWorker[workerIndex] -= lastBytesSent;\n                    bytesSentByEachWorker[workerIndex] += bytesSent;\n                  }\n\n                  lastBytesSent = bytesSent;\n                  var totalBytesSent = bytesSentByEachWorker.reduce(function (a, b) {\n                    return a + b;\n                  });\n                  progressSmoother.setValue(totalBytesSent);\n                };\n\n                return _await(uploadPart(file, nextPart, progress, addCancellationHandler, workerIndex), function () {\n                  return Upload_awaitIgnored(uploadNextPart(workerIndex));\n                });\n              }\n            });\n          });\n        };\n\n        return _await(Promise.all(_toConsumableArray(Array(maxUploadConcurrency).keys()).map(function (workerIndex) {\n          return _await(uploadNextPart(workerIndex));\n        })), function () {\n          var uploadedFile = Object.assign({\n            accountId: accountId,\n            file: file\n          }, uploadMetadata.file);\n          debug(\"File upload completed.\");\n          return uploadedFile;\n        });\n      });\n    }));\n  });\n\n  var putUploadPart = Upload_async(function (url, content, progress, addCancellationHandler) {\n    var xhr = new XMLHttpRequest();\n    var pending = true;\n    addCancellationHandler(function () {\n      if (pending) {\n        xhr.abort();\n      }\n    });\n    return Upload_finallyRethrows(function () {\n      return _await(new Promise(function (resolve, reject) {\n        xhr.upload.addEventListener(\"progress\", function (evt) {\n          if (evt.lengthComputable) {\n            progress({\n              bytesSent: evt.loaded,\n              bytesTotal: evt.total\n            });\n          }\n        }, false);\n        xhr.addEventListener(\"load\", function () {\n          // Ensure we always report the progress of a finished upload as 100%.\n          progress({\n            bytesSent: content.size,\n            bytesTotal: content.size\n          });\n\n          if (Math.floor(xhr.status / 100) === 2) {\n            var etag = xhr.getResponseHeader(\"etag\");\n\n            if (etag === null || etag === undefined) {\n              reject(new Error(\"File upload error: no etag header in upload response.\"));\n            } else {\n              resolve({\n                etag: etag\n              });\n            }\n          } else {\n            reject(new Error(\"File upload error: status code \".concat(xhr.status)));\n          }\n        });\n\n        xhr.onabort = function () {\n          return reject(new Error(\"File upload cancelled.\"));\n        };\n\n        xhr.onerror = function () {\n          return reject(new Error(\"File upload error.\"));\n        };\n\n        xhr.ontimeout = function () {\n          return reject(new Error(\"File upload timeout.\"));\n        };\n\n        xhr.open(\"PUT\", url);\n        xhr.send(content);\n      }));\n    }, function (_wasThrown, _result) {\n      pending = false;\n      return Upload_rethrow(_wasThrown, _result);\n    });\n  });\n\n  var uploadPart = Upload_async(function (file, part, progress, addCancellationHandler, workerIndex) {\n    var content = part.range.inclusiveEnd === -1 ? new Blob() : file.slice(part.range.inclusiveStart, part.range.inclusiveEnd + 1);\n    debug(\"Uploading part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n    return _await(putUploadPart(part.uploadUrl, content, progress, addCancellationHandler), function (_ref2) {\n      var etag = _ref2.etag;\n      return _await((0,upload_api_client_upload_js_namespaceObject.completeUploadPart)(getConfig(), accountId, part.uploadId, part.uploadPartIndex, {\n        etag: etag\n      }), function (_completeUploadPart) {\n        handleApiResult(_completeUploadPart);\n        debug(\"Uploaded part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n      });\n    });\n  });\n\n  var withProgressReporting = Upload_async(function (tickInterval, tick, scope) {\n    var whileReportingResolved;\n    var whileReporting = new Promise(function (resolve) {\n      whileReportingResolved = resolve;\n    });\n    var isReporting = true;\n\n    var stopReporting = function stopReporting() {\n      if (isReporting) {\n        whileReportingResolved();\n        clearInterval(intervalHandle);\n        isReporting = false;\n      }\n    };\n\n    var intervalHandle = setInterval(function () {\n      return tick(stopReporting);\n    }, tickInterval);\n    return Upload_finallyRethrows(function () {\n      return Upload_call(scope, function (result) {\n        return _await(whileReporting, function () {\n          return result;\n        });\n      });\n    }, function (_wasThrown2, _result2) {\n      stopReporting();\n      return Upload_rethrow(_wasThrown2, _result2);\n    });\n  });\n\n  var deleteAccessToken = Upload_async(function () {\n    return Upload_awaitIgnored(deleteNoResponse(accessTokenUrl, {}, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n    ));\n  });\n  /**\n   * Calls the given auth method on the canonical auth instance.\n   */\n\n\n  var callAuthMethod = Upload_async(function (other, me) {\n    var authInstance = getAuthInstance();\n    return _invokeIgnored(function () {\n      if (authInstance !== self) {\n        // Forward call to global auth instance.\n        return Upload_awaitIgnored(other(authInstance));\n      } else {\n        return _callIgnored(me);\n      }\n    });\n  });\n  /**\n   * Returns a single global instance of Upload.js for all auth calls.\n   * If we require multiple instances in the future, we can provide a parameter to disable this behaviour.\n   */\n\n\n  var getAuthInstance = function getAuthInstance() {\n    var globalKey = \"uploadJsAuthInstance\";\n    var globalAuthInstance = window[globalKey];\n\n    if (globalAuthInstance === undefined) {\n      globalAuthInstance = self;\n      window[globalKey] = self;\n    }\n\n    return globalAuthInstance;\n  };\n\n  var refreshAccessToken = Upload_async(function (authUrl, authHeaders, authSession) {\n    return _continueIgnored(_catch(function () {\n      return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n        // Session may have been ended while timer was waiting.\n        if (!authSession.isActive) {\n          return;\n        }\n\n        return Upload_call(authHeaders, function (_authHeaders) {\n          return _await(getAccessToken(authUrl, _authHeaders), function (token) {\n            return _await(putJsonGetJson(accessTokenUrl, {}, {\n              accessToken: token\n            }, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n            ), function (setTokenResult) {\n              var desiredTtlSeconds = setTokenResult.ttlSeconds - refreshBeforeExpirySeconds;\n\n              if (desiredTtlSeconds < minJwtTtlSeconds) {\n                warn(\"JWT expiration is too short: waiting for \".concat(minJwtTtlSeconds, \" seconds before refreshing.\"));\n              }\n\n              authSession.accessToken = setTokenResult.accessToken;\n              authSession.accessTokenRefreshHandle = window.setTimeout(function () {\n                refreshAccessToken(authUrl, authHeaders, authSession).then(function () {}, function (e) {\n                  return error(\"Permanent error when refreshing access token: \".concat(e));\n                });\n              }, Math.min(maxJwtTtlSeconds, Math.max(minJwtTtlSeconds, desiredTtlSeconds)) * 1000);\n            });\n          });\n        });\n      })));\n    }, function (e) {\n      // Use 'error' instead of 'debug' so that the user sees error messages.\n      error(\"Error when refreshing access token: \".concat(e)); // Perform attempts as part of same promise, rather than via a 'setTimeout' so that the 'beginAuthSession' only\n      // returns once an auth session has been successfully established.\n\n      return _await(new Promise(function (resolve) {\n        return setTimeout(resolve, retryAuthAfterErrorSeconds * 1000);\n      }), function () {\n        // Todo: is this stack safe?\n        return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n      });\n    }));\n  });\n\n  var putJsonGetJson = Upload_async(function (url, headers, requestBody, withCredentials) {\n    return _await(nonUploadApiRequest({\n      method: \"PUT\",\n      path: url,\n      headers: headers,\n      body: requestBody\n    }, withCredentials), function (_nonUploadApiRequest) {\n      return _await(handleApiResult(_nonUploadApiRequest));\n    });\n  });\n\n  var getAccessToken = Upload_async(function (authUrl, headers) {\n    var endpointName = \"Your auth API endpoint\";\n    return _await(nonUploadApiRequest({\n      method: \"GET\",\n      path: authUrl,\n      headers: headers\n    }, false), function (result) {\n      if (!result.ok) {\n        throw new Error(\"\".concat(logPrefix).concat(endpointName, \" returned a failed response. Please ensure the endpoint's status code is 200.\"));\n      }\n\n      var jwt = result.body;\n\n      if (typeof jwt !== \"string\") {\n        // We will receive 'null' if there was no content-type response header.\n        throw new Error(\"\".concat(logPrefix).concat(endpointName, \" returned an unsupported response. Please ensure: 1) 'Content-Type: text/plain' is in the HTTP response headers 2) the status code is 200.\"));\n      }\n\n      if (jwt.length === 0) {\n        throw new Error(\"\".concat(logPrefix).concat(endpointName, \" returned an empty string. Please return a valid JWT instead.\"));\n      }\n\n      if (jwt.trim().length !== jwt.length) {\n        // Whitespace can be a nightmare to spot/debug, so we fail early here.\n        throw new Error(\"\".concat(logPrefix).concat(endpointName, \" returned whitespace around the JWT, please remove it.\"));\n      }\n\n      return jwt;\n    });\n  });\n\n  var deleteNoResponse = Upload_async(function (url, headers, withCredentials) {\n    return _await(nonUploadApiRequest({\n      method: \"DELETE\",\n      path: url,\n      headers: headers\n    }, withCredentials), function (_nonUploadApiRequest2) {\n      handleApiResult(_nonUploadApiRequest2);\n    });\n  });\n\n  var handleApiResult = function handleApiResult(result) {\n    var _a;\n\n    if (result.ok) {\n      return result.body;\n    }\n\n    var errorResponseMaybe = result.body;\n\n    if (typeof ((_a = errorResponseMaybe === null || errorResponseMaybe === void 0 ? void 0 : errorResponseMaybe.error) === null || _a === void 0 ? void 0 : _a.code) === \"string\") {\n      throw new UploadApiError(errorResponseMaybe);\n    }\n\n    throw new Error(\"\".concat(logPrefix, \"Network error. If problem persists, and your network connectivity is healthy, please contact support@bytescale.com and provide: (a) time of failed request in UTC (b) screenshot of failed network response body (c) screenshot of failed network response header (d) browser + version.\"));\n  };\n\n  var nonUploadApiRequest = Upload_async(function (options, withCredentials) {\n    return (0,upload_api_client_upload_js_namespaceObject.request)({\n      BASE: options.path,\n      WITH_CREDENTIALS: withCredentials\n    }, Object.assign(Object.assign({}, options), {\n      path: \"\" // We set to \"\" because we're using \"BASE\" above instead.\n\n    }));\n  });\n\n  var getConfig = function getConfig() {\n    var apiConfig = {\n      BASE: apiUrl,\n      WITH_CREDENTIALS: true\n    };\n\n    if (authenticateWithApiKey) {\n      apiConfig.USERNAME = \"apikey\";\n      apiConfig.PASSWORD = config.apiKey;\n    }\n\n    var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken;\n\n    if (headers !== undefined || accessToken !== undefined) {\n      apiConfig.HEADERS = Upload_async(function () {\n        return _await(headers === undefined ? {} : headers(), function (headersFromConfig) {\n          var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken; // Re-fetch as there's been an async boundary so state may have changed.\n\n          return Object.assign(Object.assign({}, headersFromConfig), accessToken === undefined ? {} : {\n            \"authorization-token\": accessToken\n          });\n        }, headers === undefined);\n      });\n    }\n\n    return apiConfig;\n  };\n\n  var normalizeMimeType = function normalizeMimeType(mime) {\n    var normal = mime.toLowerCase();\n    var regex = /^[a-z0-9]+\\/[a-z0-9+\\-._]+(?:;[^=]+=[^;]+)*$/; // Sync with 'MimeTypeUnboxed' in 'upload/api'.\n\n    return regex.test(normal) ? normal : undefined;\n  };\n\n  var debug = function debug(message, workerIndex) {\n    if (debugMode) {\n      console.log(\"\".concat(logPrefix).concat(message).concat(workerIndex !== undefined ? \" (Worker \".concat(workerIndex, \")\") : \"\"));\n    }\n  };\n\n  var error = function error(message) {\n    console.error(\"\".concat(logPrefix).concat(message));\n  };\n\n  var warn = function warn(message) {\n    console.warn(\"\".concat(logPrefix).concat(message));\n  };\n\n  return self;\n}\n;// CONCATENATED MODULE: ./src/index.ts\n\n\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(__webpack_module_cache__[moduleId]) {\n/******/ \t\t\treturn __webpack_module_cache__[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t!function() {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = function(exports, definition) {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t!function() {\n/******/ \t\t__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }\n/******/ \t}();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t!function() {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = function(exports) {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/************************************************************************/\n/******/ \t// module exports must be returned from runtime so entry inlining is disabled\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(\"./src/index.ts\");\n/******/ })()\n;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}